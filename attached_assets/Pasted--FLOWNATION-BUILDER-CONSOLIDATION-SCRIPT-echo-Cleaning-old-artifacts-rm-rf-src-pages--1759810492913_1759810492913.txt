# FLOWNATION — BUILDER CONSOLIDATION SCRIPT
echo "🔧 Cleaning old artifacts..."
rm -rf src/pages
mkdir -p src/pages src/components

echo "📄 Creating unified Builder loader (Landing.jsx)..."
cat <<'EOF' > src/pages/Landing.jsx
import React, { useEffect, useState } from "react";
import { builder, BuilderComponent } from "@builder.io/react";

builder.init(import.meta.env.VITE_BUILDER_API_KEY);

export default function Landing() {
  const [content, setContent] = useState(null);

  useEffect(() => {
    builder
      .get("page", { url: window.location.pathname })
      .promise()
      .then(setContent);
  }, []);

  return (
    <div className="min-h-screen bg-black text-white">
      <BuilderComponent model="page" content={content} />
    </div>
  );
}
EOF

echo "📄 Updating App.jsx to route all pages through Builder..."
cat <<'EOF' > src/App.jsx
import React from "react";
import { BrowserRouter as Router, Routes, Route } from "react-router-dom";
import Landing from "./pages/Landing";
import "../builder/registerComponents";

export default function App() {
  return (
    <Router>
      <Routes>
        <Route path="/*" element={<Landing />} />
      </Routes>
    </Router>
  );
}
EOF

echo "📄 Ensuring builder/registerComponents.js exists..."
mkdir -p builder
cat <<'EOF' > builder/registerComponents.js
import { Builder } from "@builder.io/react";
import React from "react";

// Example placeholder — you can replace with real components later.
export const Placeholder = ({ text }) => (
  <div style={{
    padding: "40px",
    background: "#111",
    border: "1px solid #333",
    color: "#fff",
    borderRadius: "8px",
    textAlign: "center"
  }}>
    {text || "FlowNation placeholder block"}
  </div>
);

Builder.registerComponent(Placeholder, {
  name: "Placeholder",
  inputs: [{ name: "text", type: "string" }],
});
EOF

echo "⚙️ Adding Builder API key support..."
if ! grep -q "VITE_BUILDER_API_KEY" .env 2>/dev/null; then
  echo "VITE_BUILDER_API_KEY=public-yourbuilderkeyhere" >> .env
  echo "⚠️ Replace 'public-yourbuilderkeyhere' with your actual key in the Replit Secrets panel."
fi

echo "✅ Done! Replit is now wired to pull live Builder.io pages."
echo "Next:"
echo "1️⃣ Go to https://builder.io → open your FlowNation space."
echo "2️⃣ Create or open a 'Page' model for each route (/, /community, etc.)."
echo "3️⃣ Publish them."
echo "4️⃣ Run this Replit project → your live Builder pages will appear instantly."
