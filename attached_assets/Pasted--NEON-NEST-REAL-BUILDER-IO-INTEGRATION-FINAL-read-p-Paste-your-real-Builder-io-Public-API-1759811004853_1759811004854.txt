# NEON-NEST â€” REAL BUILDER.IO INTEGRATION (FINAL)
read -p "ðŸ‘‰ Paste your real Builder.io Public API Key (starts with 'public-'): " BUILDER_KEY

echo "ðŸ”§ Linking Builder.io to Replit project: neon-nest"

# Ensure dependencies and directories
npm install @builder.io/react react-router-dom lucide-react --silent
mkdir -p src/pages builder src/components

# Store real Builder key
echo "VITE_BUILDER_API_KEY=$BUILDER_KEY" > .env

# Create Landing.jsx that fetches from Builder
cat <<'EOF' > src/pages/Landing.jsx
import React, { useEffect, useState } from "react";
import { builder, BuilderComponent } from "@builder.io/react";

builder.init(import.meta.env.VITE_BUILDER_API_KEY);

export default function Landing() {
  const [content, setContent] = useState(null);

  useEffect(() => {
    builder
      .get("page", { url: window.location.pathname })
      .promise()
      .then(setContent);
  }, []);

  return (
    <div className="min-h-screen bg-black text-white">
      <BuilderComponent model="page" content={content} />
    </div>
  );
}
EOF

# Core router
cat <<'EOF' > src/App.jsx
import React from "react";
import { BrowserRouter as Router, Routes, Route } from "react-router-dom";
import Landing from "./pages/Landing";
import "../builder/registerComponents";

export default function App() {
  return (
    <Router>
      <Routes>
        <Route path="/*" element={<Landing />} />
      </Routes>
    </Router>
  );
}
EOF

# Builder component registry
cat <<'EOF' > builder/registerComponents.js
import { Builder } from "@builder.io/react";
import React from "react";

export const Placeholder = ({ text }) => (
  <div
    style={{
      padding: "40px",
      background: "#0b0b0d",
      border: "1px solid #333",
      color: "#fff",
      borderRadius: "8px",
      textAlign: "center",
    }}
  >
    {text || "FlowNation editable section"}
  </div>
);

Builder.registerComponent(Placeholder, {
  name: "Placeholder",
  inputs: [{ name: "text", type: "string", defaultValue: "Editable area" }],
});
EOF

# Vite config (if missing)
if [ ! -f vite.config.js ]; then
  cat <<'EOF' > vite.config.js
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";
export default defineConfig({
  plugins: [react()],
  server: { port: 3000, host: true },
});
EOF
fi

echo "âœ… neon-nest project now connected to Builder.io"
echo "ðŸ‘‰ Run project â†’ it will fetch live FlowNation pages from your Builder space"
echo "   using API key: $BUILDER_KEY"
